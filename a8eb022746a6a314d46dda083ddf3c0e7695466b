{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4371f329_20ad26e4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1032832
      },
      "writtenOn": "2024-09-17T23:08:21Z",
      "side": 1,
      "message": "I\u0027m a little wary of this code, but I\u0027m fairly sure I\u0027ve identified a bug here at least.\n\nJosip, are you an appropriate reviewer here?",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "921ff705_234e552c",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1698,
      "author": {
        "id": 1096638
      },
      "writtenOn": "2024-09-18T17:21:35Z",
      "side": 1,
      "message": "I think this is problematic - it\u0027s possible that _CopyAndLinkFiles overrides some local changes (e.g. your commit has added a file that is not part of manifest). It\u0027s likely an extreme case, but could still be problematic.\n\nIf the action is revertible so there\u0027s no data loss, it\u0027s probably okay to keep it. Could you test it?\n\nNote that we should schedule this in Sync_LocalHalf, and not NetworkHalf using:\n\n```\n syncbuf.later1(self, _doff, not verbose)\n ```",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4726b109_dfcbd4a9",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1698,
      "author": {
        "id": 1032832
      },
      "writtenOn": "2024-09-18T17:39:50Z",
      "side": 1,
      "message": "\u003e I think this is problematic - it\u0027s possible that _CopyAndLinkFiles overrides some local changes (e.g. your commit has added a file that is not part of manifest). It\u0027s likely an extreme case, but could still be problematic.\n\nWhat do you mean, precisely? My working model (and the use case in Pixel, where I\u0027m testing this) is to link a project file into a non-project location, like the tree root. For example, a `$ROOT/private/.../build_foo.sh` script getting linked to `$ROOT/build_foo.sh` for ease of use. That shouldn\u0027t really interact with \"local [git project] changes\".\n\nAre you suggesting use cases like `$ROOT/.../foo-project/bar.sh` linked to `$ROOT/.../foo-project/baz.sh`? And that may conflict with local changes that introduced a new (non-link / copy) `.../foo-project/baz.sh`?\n\nIf so, I didn\u0027t really think about that. If it\u0027s an untracked file ... it\u0027d be hard to tell what to do with it. It could be untracked simply because it\u0027s an old copy that needs updated, or it could be untracked because the developer is adding it.\n\nIf it\u0027s tracked, then it sounds more like an invalid state where we should throw an error. But all in all, this does sound like room for weird corner cases...\n\n\u003e If the action is revertible so there\u0027s no data loss, it\u0027s probably okay to keep it. Could you test it?\n\nCan you clarify what exactly you\u0027d like tested? Something like the untracked and tracked examples I outline above?\n\n\u003e Note that we should schedule this in Sync_LocalHalf, and not NetworkHalf using:\n\nDumb question: aren\u0027t we already in LocalHalf here?\n\n\u003e ```\n\u003e  syncbuf.later1(self, _doff, not verbose)\n\u003e  ```\n\nUpdated to this.",
      "parentUuid": "921ff705_234e552c",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b856aa2_f43bf297",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1698,
      "author": {
        "id": 1096638
      },
      "writtenOn": "2024-09-18T20:00:07Z",
      "side": 1,
      "message": "I was suggesting anytime a file is placed inside another repository.\n\nLet\u0027s say you have\n```\n\u003cproject path\u003d\"foo\"\u003e\u003c/project\u003e\n\u003cproject path\u003d\"bar\"\u003e\u003c/project\u003e\n```\nand someone updates project path bar:\n```\n\u003cproject path\u003d\"bar\"\u003e\n  \u003clinkfile src\u003d\"BAZ.txt\" dest\u003d\"foo/BAZ.txt\"\u003e\n\u003c/project\u003e\n```\n\nIf you have BAZ.txt file in foo that you are actively working on, linkfile could override it with this patch. For example, line 1724 checks if IsDirty and bails if dirty.\n\n\u003e Can you clarify what exactly you\u0027d like tested? Something like the untracked and tracked examples I outline above?\n\n\nYup, that\u0027d be great!\n\n\u003e Dumb question: aren\u0027t we already in LocalHalf here?\n\nAh, yes - we are! Sorry for confusion. It\u0027s still better to use syncbuf to be consistent.",
      "parentUuid": "4726b109_dfcbd4a9",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c8aa95b_d42730ff",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1698,
      "author": {
        "id": 1032832
      },
      "writtenOn": "2024-09-18T23:08:25Z",
      "side": 1,
      "message": "\u003e I was suggesting anytime a file is placed inside another repository.\n...\n\u003e If you have BAZ.txt file in foo that you are actively working on, linkfile could override it with this patch.\n\nIt would before this patch too, actually. (I just tested it.) In all cases (tracked, untracked, committed), it will clobber.\n\nWhat this patch \"fixes\" (and/or breaks, if you\u0027re considering this an unexpected clobbering) is when you have active work on project \"bar\" too. *And* you also have to have previously uploaded the work from project \"bar\" to Gerrit (see the `if pub:` condition). I forgot to add that part from the description (now I\u0027ve added it).\n\nSo, I don\u0027t really think this is materially changing what things we\u0027ll clobber. There are plenty of cases we\u0027ll clobber things already. If we want to make that behavior more consistent, then I think we have several other existing cases to consider. Basically, you\u0027re playing with fire if you use this feature to link or copy files between projects.\n\nI can still run through some more cases if you\u0027d like. But so far, after a few more explorations, I don\u0027t think I\u0027m materially changing the types of corner cases that already allow clobberring; I\u0027m just fixing a case that (silently) refuses to sync the intended links.",
      "parentUuid": "0b856aa2_f43bf297",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6a719258_32f3552e",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1698,
      "author": {
        "id": 1096638
      },
      "writtenOn": "2024-09-18T23:18:08Z",
      "side": 1,
      "message": "Thanks for looking into it, I think that\u0027s good enough to accept this patch.",
      "parentUuid": "2c8aa95b_d42730ff",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c7660c87_f6709c7e",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1698,
      "author": {
        "id": 1032832
      },
      "writtenOn": "2024-09-19T00:11:46Z",
      "side": 1,
      "message": "thanks!\n\ndo you think any of this clobbering behavior is worth filing a bug over? I can at least enter it in the bug tracker in case it causes problems down the road, or if someone wants to tackle it.",
      "parentUuid": "6a719258_32f3552e",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18f012b5_eed45dad",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1703,
      "author": {
        "id": 1096638
      },
      "writtenOn": "2024-09-18T17:21:35Z",
      "side": 1,
      "message": "This line instructs Sync_LocalHalf part to invoke _CopyAndLinkFiles (via _doff). So line 1706 is not needed.",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0a527427_a075d6ea",
        "filename": "project.py",
        "patchSetId": 2
      },
      "lineNbr": 1703,
      "author": {
        "id": 1032832
      },
      "writtenOn": "2024-09-18T17:39:50Z",
      "side": 1,
      "message": "ack, sorry, I missed what some of this was doing. I really care about the other branch anyway, not this one.\n\ndropped",
      "parentUuid": "18f012b5_eed45dad",
      "revId": "a8eb022746a6a314d46dda083ddf3c0e7695466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}