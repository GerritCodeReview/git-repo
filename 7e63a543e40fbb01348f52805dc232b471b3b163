{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6c56fc28_2a5905b3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1007145
      },
      "writtenOn": "2025-11-05T19:12:10Z",
      "side": 1,
      "message": "this logic seems to basically be a recovery for when _InitGitDir failed (i.e. was interrupted), but the Exception block wasn\u0027t run for whatever reason (where it deletes the gitdir).  and it relies on the current _InitGitDir implementation where it assumes the last thing it did was toggle core.bare, and it doesn\u0027t handle partial mirror init.\n\ni think this is a bandaid over the actual bug ... we shouldn\u0027t init the real directory in-situ.  _InitGitDir should initialize a temp dir, and only once it\u0027s finished, rename it to the final dir.",
      "revId": "7e63a543e40fbb01348f52805dc232b471b3b163",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "032ccf45_454f39d5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2025-11-05T19:30:31Z",
      "side": 1,
      "message": "\u003e this logic seems to basically be a recovery for when _InitGitDir failed (i.e. was interrupted), but the Exception block wasn\u0027t run for whatever reason (where it deletes the gitdir).  and it relies on the current _InitGitDir implementation where it assumes the last thing it did was toggle core.bare, and it doesn\u0027t handle partial mirror init.\n\nYes. There\u0027s a lot of cases that could cause failures that aren\u0027t helped by this change and I don\u0027t love that.\n\n\u003e \n\u003e i think this is a bandaid over the actual bug ... we shouldn\u0027t init the real directory in-situ.  _InitGitDir should initialize a temp dir, and only once it\u0027s finished, rename it to the final dir.\n\nThis sounds like a much nicer generic solution. I think we\u0027d want that temp dir in roughly the same location (i.e. don\u0027t use `$TMPDIR`) because using different/unexpected volumes during sync isn\u0027t nice. Should we do something like `.repo/projects/path/to/.tempXXXX-project` (`XXXX` replaced with random characters)? Then we can also do automatic cleanup of dirs under `/projects/` named like `.tempXXXX-`.\n\nI\u0027m not sure if we can do the same thing for `project-objects/` dirs, but that should be handled in a separate change anyway.",
      "parentUuid": "6c56fc28_2a5905b3",
      "revId": "7e63a543e40fbb01348f52805dc232b471b3b163",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c104bf61_e78b6930",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2025-11-06T19:30:58Z",
      "side": 1,
      "message": "Attempted in PS3",
      "parentUuid": "032ccf45_454f39d5",
      "revId": "7e63a543e40fbb01348f52805dc232b471b3b163",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}